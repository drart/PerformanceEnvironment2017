<!DOCTYPE html>
<head>
    <title>Test Quneo</title>
</head>

<body>
    <div id="boppad-midi-display"></div>
    <script src="../node_modules/flocking/dist/flocking-all.js"></script>
    <script src="../adam.js"></script>
    <script>

        flock.init({
            bufferSize : 256 
        });

        var cloosh = adam.cloosh();
        cloosh.play();

        var boppad = flock.midi.connection({
            openImmediately: true,
            ports: {
                name : "QUNEO"
            },
            listeners: {
                noteOn: function (msg) {
                    $("#boppad-midi-display").text(fluid.prettyPrintJSON(msg));
                    if (msg.note >= 68 && msg.note <= 83){
                        var myval = (83 - msg.note)/ (83 - 68); 
                        cloosh.set("env.gate", 1);
                        cloosh.set("boop.freq", msg.note * 40);
                        cloosh.set("freeverb.room", myval);
                        cloosh.set("freeverb.damp", 1 - myval);
                        //cloosh.set("freeverb.mix", Math.sin(myval));
                        cloosh.set("freeverb.width", Math.sin(myval));
                    }
                    //bop.set("bop.mul.gate", 1);
                },
                noteOff: function (msg) {
                    $("#boppad-midi-display").text(fluid.prettyPrintJSON(msg));
                    //bop.set("bop.mul.gate", 0);
                    cloosh.set("env.gate", 0);
                    //console.log(msg);
                },
                control: function (msg) {
                    $("#boppad-midi-display").text(fluid.prettyPrintJSON(msg));
                    //console.log(msg);
                    //bop.set("bop.mul.gate", 0);
                    if(msg.number === 10){
                        cloosh.set("freeverb.mix", msg.value/127 );
                    }
                },
                pitchbend: function(msg) {
                    $("#boppad-midi-display").text(fluid.prettyPrintJSON(msg));
                    //console.log(msg);
                },
                aftertouch: function(msg){
                    $("#boppad-midi-display").text(fluid.prettyPrintJSON(msg));
                    //console.log(msg);
                }
            }

        });

    </script>
</body>
</html>
