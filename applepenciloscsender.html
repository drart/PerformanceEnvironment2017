<html>
    <head>
        <script src="node_modules/osc/dist/osc-browser.min.js"></script>
        <style>
            html, body { overflow: hidden; margin: 0; padding: 0; }
        </style>
    </head>
    <body>
        <div id="pressure"></div>
        <div id="mousex"></div>
        <div id="mousey"></div>
        <div id="azimuth"></div>
        <div id="altitude"></div>

        <div id="console"></div>
        <div id="numtouches"></div>
        <script>
            var iptarget = prompt("Put in an IP target");
            iptarget = (iptarget === null)? "localhost": iptarget;

            var oscPort = new osc.WebSocketPort({
                url: "ws://" + iptarget + ":9000", // URL to your Web Socket server.
                metadata: true
            });
            oscPort.open();
            oscPort.on("message", function(msg){
                console.log(msg); 
            });

            document.addEventListener("mousemove", printTouchPos);
            document.addEventListener("mousedown", printTouchPos);
            document.addEventListener("mouseup", printTouchPos);

	    var touchdivs = []; 
	
	    for ( var i = 0; i < 12; i++){ // 12 is the limit for apple devices
		touchdivs.push( document.createElement('div') );
		document.body.appendChild( touchdivs[i] );
            }

            function printTouchPos(event) {
                event.preventDefault();

                var oscMessage = {
                    address:  "/mouse",
                    args: []
                };

                /// mouse event
                if (event.clientX !== undefined){
                    document.getElementById("mousex").innerHTML = event.clientX;
                    oscMessage.args.push({
                        type: "f",
                        value: event.clientX
                    });
                    document.getElementById("mousey").innerHTML = event.clientY;
                    oscMessage.args.push({
                        type: "f",
                        value: event.clientY
                    });
                }else{ /// touch event
		    for (var i = 0; i <  event.touches.length; i++ ){

			document.getElementById("numtouches").innerHTML = event.touches.length;


                    document.getElementById("mousex").innerHTML = event.touches[0].clientX;
			oscMessage.address = "/touch";
                    oscMessage.args.push({
                        type: "f",
                        value: event.touches[0].clientX
                    });
                    document.getElementById("mousey").innerHTML = event.touches[0].clientY;
                    oscMessage.args.push({
                        type: "f",
                        value: event.touches[0].clientY
                    });

                    document.getElementById("pressure").innerHTML = event.touches[0].force;
                    oscMessage.args.push({
                        type: "f",
                        value: event.touches[0].force
                    });

                    if (event.touches[0].touchType === "stylus"){
                        oscMessage.address = "/stylus";
                    
                        if( event.touches[0].azimuthAngle !== undefined){
                            document.getElementById("azimuth").innerHTML = event.touches[0].azimuthAngle;
                            oscMessage.args.push({
                                type: "f",
                                value: event.touches[0].azimuthAngle
                            });
                        }
                        if( event.touches[0].azimuthAngle !== undefined){
                            document.getElementById("altitude").innerHTML = event.touches[0].altitudeAngle;
                            oscMessage.args.push({
                                type: "f",
                                value: event.touches[0].altitudeAngle
                            });
                        }
                    }

                }

			oscPort.send(oscMessage);
		}
            }

            document.addEventListener("touchstart", printTouchPos);
            document.addEventListener("touchmove", printTouchPos);
            document.addEventListener("touchend", printTouchPos);
            document.addEventListener("touchforcechange", printTouchPos);
        </script>
    </body>
</html>
