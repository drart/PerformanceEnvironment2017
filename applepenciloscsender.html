
<html>
    <head>
        <script src="node_modules/osc/dist/osc-browser.min.js"></script>
        <style>
            html, body { overflow: hidden; margin: 0; padding: 0; }
        </style>
    </head>
    <body>
        <div id="pressure"></div>
        <div id="mousex"></div>
        <div id="mousey"></div>
        <div id="azimuth"></div>
        <div id="altitude"></div>

        <div id="console"></div>
        <script>
            var iptarget = prompt("Put in an IP target");
            iptarget = (iptarget === null)? "localhost": iptarget;

            var oscPort = new osc.WebSocketPort({
                url: "ws://" + iptarget + ":9000", // URL to your Web Socket server.
                metadata: true
            });
            oscPort.open();
            oscPort.on("message", function(msg){
                console.log(msg); 
            });

            document.addEventListener("mousemove", printTouchPos);
            document.addEventListener("mousedown", printTouchPos);
            document.addEventListener("mouseup", printTouchPos);

            function printTouchPos(event) {
                event.preventDefault();

                var oscMessage = {
                    address:  "/pressurexy",
                    args: []
                };

                /// mouse event
                if (event.clientX !== undefined){
                    document.getElementById("mousex").innerHTML = event.clientX;
                    oscMessage.args.push({
                        type: "f",
                        value: event.clientX
                    });
                    document.getElementById("mousey").innerHTML = event.clientY;
                    oscMessage.args.push({
                        type: "f",
                        value: event.clientY
                    });
                }else{ /// touch event
                    document.getElementById("mousex").innerHTML = event.touches[0].clientX;
                    oscMessage.args.push({
                        type: "f",
                        value: event.touches[0].clientX
                    });
                    document.getElementById("mousey").innerHTML = event.touches[0].clientY;
                    oscMessage.args.push({
                        type: "f",
                        value: event.touches[0].clientY
                    });

                    document.getElementById("pressure").innerHTML = event.touches[0].force;
                    oscMessage.args.push({
                        type: "f",
                        value: event.touches[0].force
                    });

                    if (event.touches[0].touchType === "stylus"){
                        oscMessage.address = "/applepencil";
                    
                        if( event.touches[0].azimuthAngle !== undefined){
                            document.getElementById("azimuth").innerHTML = event.touches[0].azimuthAngle;
                            oscMessage.args.push({
                                type: "f",
                                value: event.touches[0].azimuthAngle
                            });
                        }
                        if( event.touches[0].azimuthAngle !== undefined){
                            document.getElementById("altitude").innerHTML = event.touches[0].altitudeAngle;
                            oscMessage.args.push({
                                type: "f",
                                value: event.touches[0].altitudeAngle
                            });
                        }
                    }




                    for(var i = 0; i < event.targetTouches.length; i++){
                        if(event.targetTouches[i].force !== undefined){
                            //document.getElementById("pressure").innerHTML = event.touches[i].force;
                        } 
                    }
                }

                oscPort.send(oscMessage);
            }

            document.addEventListener("touchstart", printTouchPos);
            document.addEventListener("touchmove", printTouchPos);
            document.addEventListener("touchend", printTouchPos);
            document.addEventListener("touchforcechange", printTouchPos);
        </script>
    </body>
</html>
